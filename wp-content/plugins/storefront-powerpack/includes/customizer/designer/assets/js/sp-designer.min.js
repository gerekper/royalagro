!function(a,s){"use strict";var r;function n(e){return/^#[0-9A-F]{6}$/i.test(e)?e:"rgba(0, 0, 0, 0)"===e||"transparent"===e?"":"#"+t((e=e.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i))[1])+t(e[2])+t(e[3]);function t(e){return("0"+parseInt(e,10).toString(16)).slice(-2)}}function i(e){return/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(e)}a&&a.customize&&((r=a.customize).SPDesigner=r.SPDesigner||{},r.SPDesigner.data={phpIntMax:0,section:"",fontVariants:{}},"undefined"!=typeof _wpCustomizeSPDesignerSettings&&s.extend(r.SPDesigner.data,_wpCustomizeSPDesignerSettings),r.SPDesigner.generateRandomSelectorId=function(){return Math.ceil(r.SPDesigner.data.phpIntMax*Math.random())},r.SPDesigner.measurementPicker={_create:function(){var e=this,t=e.element;e.close=s.proxy(e.close,e),this.valueInput=t.find(".sp-measurement-value"),this.unitSelect=t.find(".sp-measurement-unit"),this.valueInput&&this.unitSelect&&(this.valueInput.next(".sp-measurement-unit").addBack().wrapAll('<div class="sp-measurement-picker" />'),e.wrap=this.valueInput.parent().hide().wrap(s('<div class="sp-measurement-container" />')),e.container=e.wrap.parent(),e.toggler=s('<a tabindex="0" class="button sp-measurement-result" />').prependTo(e.container),e.updateToggler(),e._addListeners())},_addListeners:function(){var e=this;e.container.on("click.measurementpicker",function(e){e.stopPropagation()}),e.toggler.click(function(){e.toggler.hasClass("sp-measurement-picker-open")?e.close():e.open()}),e.valueInput.change(function(){e.updateToggler()}),e.unitSelect.change(function(){e.updateToggler()})},open:function(){this.wrap.show(),this.toggler.hide(),this.wrap.addClass("sp-measurement-picker-active"),this.toggler.addClass("sp-measurement-picker-open"),s("body").trigger("click.measurementpicker").on("click.measurementpicker",this.close)},close:function(){this.wrap.hide(),this.toggler.show(),this.wrap.removeClass("sp-measurement-picker-active"),this.toggler.removeClass("sp-measurement-picker-open"),s("body").off("click.measurementpicker",this.close)},updateToggler:function(){this.toggler.text(this.valueInput.val().toString()+this.unitSelect.val().toString())}},s.widget("sp.spMeasurementPicker",r.SPDesigner.measurementPicker),r.SPDesigner.CSSControl=r.Control.extend({ready:function(){var t=this;t.active.validate=function(){var e=r.section(t.section()),e=!!e&&e.active();return e},this._setupUpdateUI(),this._setupUI()},focus:function(){r.each(function(e,t){t.match(/^sp_designer_css_data\[(.+?)]/)&&!_.isUndefined(r.control(t))&&r.control(t).close()}),this.open()},open:function(){this.container.closest(".accordion-section-content").addClass("sp-designer-control-settings-visible"),this.container.find(".sp-designer-selector-content").addClass("sp-designer-selector-content-visible"),s(this.container.closest(".accordion-section-content")).hasClass("customize-pane-child")||(this._resizeContentHeight(),s(window).on("resize.customizer-section",_.debounce(_.bind(this._resizeContentHeight,this),200)))},close:function(){this.container.closest(".sp-designer-control-settings-visible").removeClass("sp-designer-control-settings-visible"),this.container.find(".sp-designer-selector-content-visible").removeClass("sp-designer-selector-content-visible")},_setupUI:function(){var n=this,e=a.template("sp-designer-selector-title"),t={action:r.section(this.section()).params.customizeAction,title:r.section(this.section()).params.title},i=n.container;i.closest(".accordion-section-content").addClass("sp-accordion-section-content"),i.find(".sp-designer-selector-content").prepend(e(t)),i.find(".sp-designer-selector-title").on("click",function(e){e.preventDefault(),n.open()}),i.find(".customize-section-back").on("click",function(e){e.preventDefault(),n.close()}),i.find("button.item-delete").on("click",function(e){e.preventDefault(),n.setting.set(!1)}),i.find('[data-sp-designer-property="fontFamily"]').selectize({onChange:function(e){var t=_.findWhere(r.SPDesigner.data.fontVariants,{family:e}),e=i.find('[data-sp-designer-property="fontVariant"]')[0].selectize,t=n._getFontVariantOptions(t);e.clearOptions(),e.addOption(t),_.findWhere(t,{id:"regular"})?e.setValue("regular"):e.setValue(t[0].id),e.refreshOptions(!1),t.length<=1?e.disable():e.enable()},onDropdownClose:function(){""===this.getValue()&&this.setValue("Default")}}),i.find('[data-sp-designer-property="fontVariant"]').selectize({valueField:"id",labelField:"text",searchField:"text",onInitialize:function(){var e=i.find('[data-sp-designer-property="fontFamily"]')[0].selectize,t=_.findWhere(r.SPDesigner.data.fontVariants,{family:e.getValue()}),e=n._getFontVariantOptions(t);this.clearOptions(),this.addOption(e),t=_.noop(),(t=n.elements.fontVariant&&!_.isUndefined(n.elements.fontVariant.get())?n.elements.fontVariant.get():t)?this.setValue(n.elements.fontVariant.get()):this.setValue("regular"),this.refreshOptions(!1),e.length<=1?this.disable():this.enable()},onDropdownClose:function(){""===this.getValue()&&this.setValue("regular")}}),i.find(".sp-designer-color input[type=text]").wpColorPicker({change:function(){var e=s(this).data("sp-designer-property");n.elements[e]&&n.elements[e].set(s(this).wpColorPicker("color"))},clear:function(){var e=s(this).data("sp-designer-property");n.elements[e]&&n.elements[e].set("")}}),i.find(".sp-designer-measurement").spMeasurementPicker(),n.bgImage={},n.bgImage.container=i.find(".sp-designer-background-image"),n.bgImage.placeholder=s(n.bgImage.container).find(".placeholder"),n.bgImage.img=s(n.bgImage.container).find("img"),n.bgImage.btnAdd=s(n.bgImage.container).find(".new"),n.bgImage.btnChange=s(n.bgImage.container).find(".change"),n.bgImage.btnRemove=s(n.bgImage.container).find(".remove"),n.bgImage.bgRepeat=i.find(".sp-designer-background-repeat"),n.bgImage.bgPosition=i.find(".sp-designer-background-position"),n.bgImage.bgAttachment=i.find(".sp-designer-background-attachment"),_.bindAll(n,"_bgImageRemoveImg","_bgImageUpload","_bgImageRender","_bgImageUpdate","_bgImagePick"),n.bgImage.btnAdd.on("click",this._bgImageUpload),n.bgImage.btnChange.on("click",this._bgImageUpload),n.bgImage.btnRemove.on("click",this._bgImageRemoveImg),this._bgImageRender()},_setupUpdateUI:function(){var a=this,e=a.setting(),t=["updateDisplay","fontStyle","textUnderline","textLineThrough","fontFamily","fontVariant","fontSize","fontSizeUnit","fontWeight","lineHeight","letterSpacing","letterSpacingUnit","letterSpacingUnit","color","marginTop","marginTopUnit","marginBottom","marginBottomUnit","marginLeft","marginLeftUnit","marginRight","marginRightUnit","paddingTop","paddingTopUnit","paddingBottom","paddingBottomUnit","paddingLeft","paddingLeftUnit","paddingRight","paddingRightUnit","borderRadius","borderRadiusUnit","borderColor","borderStyle","borderWidth","borderWidthUnit","backgroundColor","backgroundRepeat","backgroundPosition","backgroundAttachment"];a.elements={},_.each(t,function(e){a.elements[e]=new r.Element(a.container.find('[data-sp-designer-property="'+e+'"]'))}),_.each(a.elements,function(n,i){n.bind(function(e){n.element.is("input[type=checkbox]")&&(e=e?n.element.val():""),"fontWeight"===i&&"bold"===e&&(e=700);var t=a.setting();t&&t[i]!==e&&((t=_.clone(t))[i]=e,a.setting.set(t),n.set(t[i]))}),e&&n.set(e[i])}),a.setting.bind(function(n){!1===n?(a.close(),a.container.remove(),r.control.remove(a.id),r.previewer.refresh()):_.each(n,function(e,t){a.elements[t]&&a.elements[t].set(n[t])})})},_getFontVariantOptions:function(e){var t=[];return _.isUndefined(e)||_.isUndefined(e.variants)?t.push({id:"regular",text:"Regular"}):t=e.variants,t},_bgImageUpload:function(e){e.preventDefault(),this.bgImage.frame||this._bgImageInitFrame(),this.bgImage.frame.open()},_bgImageInitFrame:function(){this.bgImage.frame=a.media({title:r.SPDesigner.data.bgImage.l10n.choose,library:{type:r.SPDesigner.data.bgImage.mime_type},button:{text:r.SPDesigner.data.bgImage.l10n.set},multiple:!1}),this.bgImage.frame.on("select",this._bgImagePick)},_bgImagePick:function(){var e=this.bgImage.frame.state().get("selection").single();"image"===e.get("type")&&(e=this._bgImageReduceMembers(e.toJSON()),this._bgImageUpdate(e))},_bgImageReduceMembers:function(n){var i={};return s.each(["id","sizes","url"],function(e,t){i[t]=n[t]}),i},_bgImageRemoveImg:function(e){e.preventDefault(),this._bgImageUpdate({url:"",id:0})},_bgImageUpdate:function(e){var t=this.setting(),n="backgroundImage";t&&t[n]!==e&&((t=_.clone(t))[n]=e,this.setting.set(t),this._bgImageRender())},_bgImageRender:function(){var e=this.setting();e&&e.backgroundImage&&e.backgroundImage.url?(this.bgImage.placeholder.hide(),e.backgroundImage.sizes&&e.backgroundImage.sizes.medium?this.bgImage.img.attr("src",e.backgroundImage.sizes.medium.url):this.bgImage.img.attr("src",e.backgroundImage.url),this.bgImage.img.show(),this.bgImage.btnRemove.show(),this.bgImage.btnChange.show(),this.bgImage.btnAdd.hide(),this.bgImage.bgRepeat.show(),this.bgImage.bgPosition.show(),this.bgImage.bgAttachment.show()):(this.bgImage.img.hide(),this.bgImage.placeholder.show(),this.bgImage.btnRemove.hide(),this.bgImage.btnChange.hide(),this.bgImage.btnAdd.show(),this.bgImage.bgRepeat.hide(),this.bgImage.bgPosition.hide(),this.bgImage.bgAttachment.hide())},_resizeContentHeight:function(){this.container.find(".sp-designer-selector-content").css("height",this.container.closest(".accordion-section-content").height())}}),r.SPDesignerCustomizer={pointClickStatus:!1,init:function(){r.previewer.bind("sp-designer-click-selector",s.proxy(this.maybeBuildControl,this)),this.pointClickToggle()},pointClickToggle:function(){var t=this;s(".sp-designer-point-click-toggle").on("click",function(e){e.preventDefault(),!1===t.pointClickStatus?t.pointClickStatus=!0:t.pointClickStatus=!1,s(this).closest("#customize-theme-controls").toggleClass("sp-add-a-style-active",t.pointClickStatus),r.previewer.send("sp-designer-point-click",t.pointClickStatus)})},maybeBuildControl:function(i){var e,t,n,a,o=_.noop();r.each(function(e,t){var n;t.match(/^sp_designer_css_data\[(.+?)]/)&&!_.isUndefined(r.control(t))&&(t=(n=r.control(t)).setting(),n&&i.selector===t.selector&&(o=n))}),_.isUndefined(o)&&(t="sp_designer_css_data["+(e=r.SPDesigner.generateRandomSelectorId())+"]",a={type:"sp_designer_css_data",transport:"postMessage",previewer:r.previewer},(n=this._handleDefaults(i.cssProperties)).selector=i.selector,r.create(t,t,n,a),a=_.findWhere(r.SPDesigner.data.selectorsMap,{selector:i.selector}),a=_.isUndefined(a)?i.selector:a.name,o=new r.controlConstructor.sp_designer_css(t,{params:{type:"sp_designer_css",content:'<li id="customize-control-'+String(e)+'" class="customize-control customize-control-sp_designer_css"></li>',label:a,section:r.SPDesigner.data.section,priority:this._calculatePriority(),active:!0,settings:{default:t},id:e,css:n},previewer:r.previewer}),r.control.add(t,o)),this.pointClickStatus=!1,s("#customize-theme-controls").toggleClass("sp-add-a-style-active",!1),r.previewer.send("sp-designer-point-click",!1),o.focus()},_calculatePriority:function(){var t=10;return r.control.each(function(e){"sp_designer_css"===e.params.type&&e.setting()&&(t=Math.max(t,e.priority()))}),t+=1},_handleDefaults:function(e){var t={updateDisplay:e.display?"none":"inline",fontSize:e.fontSize&&0<=parseInt(e.fontSize,10)?parseInt(e.fontSize,10):0,fontSizeUnit:e.fontSizeUnit||"px",letterSpacing:e.letterSpacing?parseInt(e.letterSpacing,10):0,letterSpacingUnit:e.letterSpacingUnit||"px",lineHeight:e.lineHeight&&0<=parseInt(e.lineHeight,10)?parseInt(e.lineHeight,10):0,fontFamily:e.fontFamily||"Default",fontStyle:"italic"===e.fontStyle?e.fontStyle:"",color:e.color&&i(n(e.color))?n(e.color):"",borderRadius:e.borderRadius&&0<=parseInt(e.borderRadius,10)?parseInt(e.borderRadius,10):0,borderRadiusUnit:e.borderRadiusUnit||"px",borderColor:e.borderColor&&i(n(e.borderColor))?n(e.borderColor):"",borderStyle:_.contains(["none","dotted","dashed","double","solid"],e.borderStyle)?e.borderStyle:"none",borderWidth:e.borderWidth&&0<parseInt(e.borderWidth,10)?parseInt(e.borderWidth,10):1,borderWidthUnit:e.borderWidthUnit||"px",backgroundColor:e.backgroundColor&&i(n(e.backgroundColor))?n(e.backgroundColor):"",backgroundRepeat:_.contains(["no-repeat","repeat","repeat-x","repeat-y"],e.backgroundRepeat)?e.backgroundRepeat:"no-repeat",backgroundPosition:_.contains(["left","center","right"],e.backgroundPosition)?e.backgroundPosition:"left",backgroundAttachment:_.contains(["scroll","fixed"],e.backgroundAttachment)?e.backgroundAttachment:"scroll",marginTop:e.marginTop?parseInt(e.marginTop,10):0,marginTopUnit:e.marginTopUnit||"px",marginLeft:e.marginLeft?parseInt(e.marginLeft,10):0,marginLeftUnit:e.marginLeftUnit||"px",marginRight:e.marginRight?parseInt(e.marginRight,10):0,marginRightUnit:e.marginRightUnit||"px",marginBottom:e.marginBottom?parseInt(e.marginBottom,10):0,marginBottomUnit:e.marginBottomUnit||"px",paddingTop:e.paddingTop&&0<=parseInt(e.paddingTop,10)?parseInt(e.paddingTop,10):0,paddingTopUnit:e.paddingTopUnit||"px",paddingLeft:e.paddingLeft&&0<=parseInt(e.paddingLeft,10)?parseInt(e.paddingLeft,10):0,paddingLeftUnit:e.paddingLeftUnit||"px",paddingRight:e.paddingRight&&0<=parseInt(e.paddingRight,10)?parseInt(e.paddingRight,10):0,paddingRightUnit:e.paddingRightUnit||"px",paddingBottom:e.paddingBottom&&0<=parseInt(e.paddingBottom,10)?parseInt(e.paddingBottom,10):0,paddingBottomUnit:e.paddingBottomUnit||"px",fontWeight:""};return isNaN(e.fontWeight)&&"bold"===e.fontWeight?t.fontWeight=700:_.contains([100,200,300,400,500,600,700,800,900],parseInt(e.fontWeight,10))&&(t.fontWeight=parseInt(e.fontWeight,10)),t.textUnderline="",t.textLineThrough="",e.textDecoration&&"none"!==e.textDecoration&&(e=_.compact(e.textDecoration.split(" ")),_.contains(e,"underline")&&(t.textUnderline="underline"),_.contains(e,"line-through")&&(t.textLineThrough="line-through")),t}},s.extend(r.controlConstructor,{sp_designer_css:r.SPDesigner.CSSControl}),r.bind("ready",function(){r.SPDesignerCustomizer.init()}))}(window.wp,jQuery);