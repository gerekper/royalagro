!function(s){function l(t){t=function(t,r){for(key in r)r.hasOwnProperty(key)&&void 0===t[key]&&(t[key]=r[key]);return t}(t,{intent:"",total:0,formId:null,amount:null,amountType:null,products:null,productsType:null,includeShipping:!0,includeDiscounts:!1,calculateByProduct:!1});var r,n=0,a=s.isArray(t.products)&&0<t.products.length?d(t.formId,t.products,t.includeDiscounts):0;switch(t.amount||(t.amount=0),t.includeShipping||(t.total-=(r=t.formId,gformGetShippingPrice(r))),t.productsType){case"include":t.total=a;break;case"exclude":t.total-=a}switch(t.amountType){case null:n=t.total;break;case"percent":n=t.total*(t.amount/100);break;default:var o=t.amount;if(t.calculateByProduct){var i=p(t.formId);o*=100*t.total/i/100}n=o}return n=Math.max(0,parseFloat(n))}function d(t,r,n){if(void 0===r&&window._gformPriceFields?r=_gformPriceFields[t]:s.isArray(r)||(r=[r]),!r)return 0;for(var a=0,o=0;o<r.length;o++){var i=gformCalculateProductPrice(t,r[o]);if(a+=i,n)a-=Math.abs(g(t,i,r[o]))+(jQuery("#gf_coupons_"+t).val()?e(t,i):0)}return a}function p(t,r){return d(t)-(void 0!==r&&r?d(t,r):0)}function g(i,e,u){var t=s("#gform_wrapper_"+i+" .ginput_discount_input"),c=0;return t.each(function(){var t=s(this).val(),r=s(this).data("products"),n=s(this).data("productstype");if(gformIsHidden(s(this)))return 0!==t&&"0"!==t&&s(this).val(0).change(),!0;if(u&&r){if("include"==n&&(-1===s.inArray(u,r)||0===parseInt(e)))return!0;if("exclude"==n&&(-1!==s.inArray(u,r)||0===parseInt(e)))return!0}var a=u&&0<u,o=l({intent:"Calculating discount for Discount field {0}".format(s(this).attr("id")),total:e,formId:i,amount:s(this).data("amount"),amountType:s(this).data("amounttype"),products:r,productsType:n,includeShipping:!1,calculateByProduct:a});"include"===n&&0<r.length&&(o=Math.min(d(i,r,!1),o)),o*=-1,o=gform.applyFilters("gpecf_discount_total",o,s(this)),a||String(t)===String(o)||s(this).val(o).change(),c+=o}),c}function e(t,r){var n,a,o=window["gf_coupons"+t],i=0;for(n in o)o.hasOwnProperty(n)&&(a=o[n],i+=GetDiscount(a.type,a.amount,r,i));return i}function i(t,r){var n=rgars(window,"gf_global/gfcalc/{0}".format(t));n&&n.runCalcs(t,n.formulaFields)}function u(t,r){return Number(Math.round(t+"e"+r)+"e-"+r)}gform.addFilter("gform_calculation_formula",function(t,r,n,a){var o=-1!=t.search("{coupons}"),i=-1!=t.search("{discounts}"),e=-1!=t.search("{subtotal}");if(!o&&!i&&!e)return t;var u=""!=(gformIsHidden(s("#gf_coupon_code_"+n))?"":s("#gf_coupon_codes_"+n).val())||""!=s("#gf_coupons_"+n).val(),c=p(n,s("#field_{0}_{1}".format(n,r.field_id)).hasClass("gfield_price")?[r.field_id]:null),l=s("#gf_total_no_discount_"+n).val(),d=0,f=-1*g(n,c);return void 0!==l&&u&&window.PopulateDiscountInfo&&(d=PopulateDiscountInfo(l,n)),t=(t=(t=t.replace(/{coupons}/gi,parseFloat(d))).replace(/{discounts}/gi,parseFloat(f+d))).replace(/{subtotal}/gi,parseFloat(c))}),gform.addFilter("gform_coupons_discount_amount",function(t,r,n,a,o){var i=arguments.callee.caller.caller.caller.caller;if("PopulateDiscountInfo"!=i.name)return t;var e=i.arguments[1],u=gformGetShippingPrice(e);a=Math.max(0,a-u);return"percentage"==r?t=a*Number(n/100):"flat"==r&&a<(t=Number(n))&&(t=a),t}),gform.addFilter("gform_product_total",function(n,a){return s("#gform_wrapper_"+a+" .ginput_subtotal_input").each(function(){var t=s(this).val();if(gformIsHidden(s(this)))return 0!==t&&"0"!==t&&s(this).val(0).change(),!0;var r=l({intent:"Calculating subtotal for Subtotal field {0}".format(s(this).attr("id")),total:n,formId:a,amount:null,amountType:null,productsType:s(this).data("productstype"),products:s(this).data("products"),includeShipping:!1});String(t)!=String(r)&&s(this).val(r).change()}),n},48),gform.addFilter("gform_product_total",function(t,r){return t+=g(r,t),Math.max(0,t)},49),gform.addFilter("gform_product_total",function(n,a){var t=s("#gform_wrapper_"+a+" .ginput_tax_input"),o=0;return t.each(function(){var t=s(this).val();if(gformIsHidden(s(this)))return 0!==t&&"0"!==t&&s(this).val(0).change(),!0;var r=l({intent:"Calculating tax for Tax field {0}".format(s(this).attr("id")),total:n,formId:a,amount:s(this).data("amount"),amountType:s(this).data("amounttype"),products:s(this).data("products"),productsType:s(this).data("productstype"),includeDiscounts:!0});String(t)!==String(r)&&s(this).val(r).change(),o+=u(r,2)}),u(n+=o,2)},51),gform.addFilter("gform_product_total",function(t,r){var n=s("#gf_coupon_codes_{0}".format(r));return n.data("gpecfChanged")&&(n.data("gpecfChanged",!1),s(document).trigger("gform_post_conditional_logic")),t}),s(document).on("gform_post_render",function(t,r){s("#gf_coupon_codes_{0}".format(r)).change(function(){s(this).data("gpecfChanged",!0)}),s(document).on("gform_price_change",function(t,r,n){i(r.formId)}),gform.addAction("gpcp_after_update_pricing",function(t,r){i(r._formId)}),gform.addAction("gform_input_change",function(t,r,n){var a=0===s(t).attr("id").indexOf("ginput_base_price"),o=s(t).parents("li.gfield").hasClass("gfield_calculation");a&&o&&i(r)});var n=setInterval(function(){window._gformPriceFields&&window._gformPriceFields[r]&&(s(document).trigger("gform_post_conditional_logic"),clearInterval(n))});s("#gform_wrapper_"+r).find(".ginput_subtotal_input, .ginput_discount_input, .ginput_tax_input").change()})}(jQuery);
//# sourceMappingURL=gp-ecommerce-fields.js.map