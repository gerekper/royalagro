!function(G){G.fn.setGroupId=function(e){return this.attr("data-groupId",e),this.each(function(){var t=l(G(this));t&&(t.layoutGroupId=e)}),this},G.fn.setGridColumnSpan=function(e){return null===e?this.css("grid-column","auto / auto"):(this.css("grid-column","span {0}".format(e)),this.each(function(){if(G(this).hasClass("spacer")){var t=G(this).prev(".gfield");(r=l(t)).layoutSpacerGridColumnSpan=e}else(r=l(G(this)))&&(r.layoutGridColumnSpan=e)})),this;var r},G.fn.getGridColumnSpan=function(){var t=parseInt(this.css("gridColumnStart").split(" ")[1]);return isNaN(t)&&void 0!==y&&(t=y),t},String.prototype.format=function(){var r=arguments;return this.replace(/{(\d+)}/g,function(t,e){return void 0!==r[e]?r[e]:t})};var i,p=G("#form_editor_fields_container"),m=G(".gform_editor"),S=G("#gform_fields"),t=G("#no-fields"),v=G(".editor-sidebar"),C=G(".gfield-field-action"),x=null,e=".add-buttons button",y=getComputedStyle(S[0])["grid-template-columns"].split(" ").length,b=y/4,w=null,n=!1;function o(t){t.hasClass("ui-draggable")&&t.draggable("destroy").resizable("destroy"),t.draggable({helper:"clone",zIndex:999,handle:".gfield-drag",create:function(t,e){if(!M(G(this))){var r,i=G(this).attr("id").replace("field_",""),n=!!i&&GetFieldById(i);n&&n.layoutGroupId&&!m.hasClass("gform_legacy_markup")?r=n.layoutGroupId:I(G(this),!1)||(r=I()),G(this).setGroupId(r)}},start:function(t,e){S.addClass("dragging"),(x=G(e.helper.context)).addClass("placeholder")},drag:function(t,e){e.helper.width(x.width()).height(x.height()).setGridColumnSpan(null),a(0,e,e.position.top,e.position.left)},stop:function(t,e){S.removeClass("dragging"),x.removeClass("placeholder"),A().removeClass("hovering"),k().data("target")&&d(x,k().data("target"),k().data("where")),k().remove(),e.helper.remove()}}).resizable({handles:"e",start:function(){w=null,S.addClass("resizing")},resize:function(t,e){var r,i,n,o,a,d,l,s,u,f,h=S.outerWidth()/y,c=e.element,g=c.outerWidth(),p=Math.max(b,Math.round(g/h)),m=c.getGridColumnSpan(),v=W(I(c)),C=(i=c,1===(n=(n=v).not(".spacer")).length||n.last()[0]===i[0]),x=v.filter(".spacer"),_=C&&!x.length?null:c.next();null===w&&(w=1<v.length?m+(r=_?H(_):0):y),o=p,a=b,d=w-(1<v.length&&!C?b:0),p=Math.max(a,Math.min(d,o)),G().add(e.helper).add(e.element).css("width","auto").setGridColumnSpan(p),_&&(r=w-p,_.css("width","auto").setGridColumnSpan(r)),p==y||p==w?z(x):C&&!x.length&&H(v)<y&&(s=I(l=c),u=1,f=G('<div class="spacer gfield"></div>').setGroupId(s).setGridColumnSpan(u),l.after(f))},stop:function(){S.removeClass("resizing")}})}function a(t,e,l,s){var r,i,n,o,a,d,u,f,h,c,g;(A().removeClass("hovering"),r=s,i=l,n=p.offset(),o=S.offset(),a=o.top-n.top,d=o.left-n.left,u=C.outerWidth(),f=-a+u,h=-d+p.outerWidth()-v.outerWidth()-u,c=-a+p.outerHeight(),g=-d,f<i&&i<c&&g<r&&r<h)?l<0?k().css({top:-10,left:0,height:"4px",width:S.outerWidth()}).data({where:"top",target:A().first()}):l>S.outerHeight()?k().css({top:S.outerHeight()+6,left:0,height:"4px",width:S.outerWidth()}).data({where:"bottom",target:A().last()}):A().not(e.helper).not(e.helper.context).each(function(){var t=G(this),e=t.position(),r={top:e.top,right:e.left+t.outerWidth(),bottom:e.top+t.outerHeight(),left:e.left};if(i=s,(n=l)<(o=r).bottom&&n>o.top&&i<o.right&&i>o.left){var i,n,o;t.addClass("hovering");var a=function(t,e,r,i,n){var o=r.left+i/2,a=r.right-i/2,d=r.top+n/5,l=r.bottom-n/5;{if(e>r.top&&e<d)return"top";if(e<r.bottom&&l<e)return"bottom";if(t>r.left&&t<o)return"left";if(t<r.right&&a<t)return"right"}return"center"}(s,l,r,t.outerWidth(),t.outerHeight()),d=W(I(t)).length>=y/b;if("left"===a||"right"===a){if(!function(t,e){if(m.hasClass("gform_legacy_markup"))return;if(t.hasClass("gpage")||t.hasClass("gsection")||t.hasClass("gform_hidden"))return;if(e.hasClass("gpage")||e.hasClass("gsection")||e.hasClass("gform_hidden"))return;if(e.is("button")&&-1!==G.inArray(e.val().toLowerCase(),["page","section"]))return;return 1}(t,x))return;if(d)return}switch(M(t)&&(e=(t=t.prev()).position(),a="right"),k().data({where:a,target:t}),a){case"left":return k().css({top:e.top,left:e.left-10,height:t.outerHeight(),width:"4px"}),!1;case"right":return k().css({top:e.top,left:e.left+t.outerWidth()+6,right:"auto",height:t.outerHeight(),width:"4px"}),!1;case"bottom":return k().css({top:e.top+t.outerHeight()+6,left:0,height:"4px",width:"100%"}),!1;case"top":return k().css({top:e.top-10,left:0,height:"4px",width:"100%"}),!1}}}):k(!1).remove()}function d(t,e,r){if(e){var i,n,o,a,d,l,s,u,f,h,c;if(l=I(t),o=W(d=I(e)),M(e)?e=(u=e).prev():M(e.next())&&!1!==o.index(e.next())&&(u=e.next()),u&&(i=u.getGridColumnSpan(),z(u),o=W(d)),s="left"===r||"right"===r,"top"==r?e=o.first():"bottom"==r&&(e=o.last()),"top"==r||"left"==r?t.insertBefore(e):t.insertAfter(e),s)if(i?(a=t,n=i):(h=(f=o).first().getGridColumnSpan(),c=!0,f.each(function(){if(G(this).getGridColumnSpan()!==h)return c=!1}),a=c?(n=y/(o.length+1),o.add(t)):(n=(i=e.getGridColumnSpan())/2,e.add(t))),parseInt(n)==n)a.setGridColumnSpan(n);else{var g=Math.floor(n),p=Math.ceil(n);t.setGridColumnSpan(g),e.setGridColumnSpan(p)}else d=I(),t.setGridColumnSpan(y);t.setGroupId(d),_(l)}}function I(t,e){var r;return void 0!==t&&(r=t.attr("data-groupId")),r||!e&&void 0!==e||(r="xxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)})),r}function W(t){return A().filter('[data-groupId="{0}"]'.format(t)).not(".ui-draggable-dragging")}function H(t){var e=0;return t.each(function(){e+=G(this).getGridColumnSpan()}),e}function _(t){var e=W(t),r=y/e.length;e.setGridColumnSpan(r)}function z(t){t.setGridColumnSpan(0).remove()}function M(t){return 0<t.filter(".spacer").length}function l(t){var e=t.attr("id"),r=!(!e||-1===e.indexOf("field_"))&&String(e).replace("field_","");return!!r&&GetFieldById(r)}function s(t){return StartAddField(t,Math.max(0,S.children().index(x)))}function r(){A().removeClass("field_selected"),G(".sidebar").tabs("option","active",0),HideSettings()}function A(){return S.find(".gfield")}function k(t){t=void 0===t;var e=G("#indicator");return!e.length&&t&&(e=G('<div id="indicator"></div>'),S.append(e)),e}o(A()),G(e).draggable({helper:"clone",revert:function(){return!1},cancel:!1,appendTo:S,containment:"document",start:function(t,e){if(r(),p.css("z-index",2),1==gf_vars.currentlyAddingField)return!1;e.helper.width(G(e.helper.context).width()).height(G(e.helper.context).height()),S.addClass("dragging"),(x=G(e.helper.context).clone()).addClass("placeholder"),G(this).css("opacity",.5)},drag:function(t,e){if(form.fields.length){var r=+e.position.top+e.helper.outerHeight()/2,i=+e.position.left+e.helper.outerWidth()/2;a(0,e,r,i)}},stop:function(t,e){G(this).css("opacity",1),p.css("z-index",1),S.removeClass("dragging");var r=!1;!form.fields.length&&n?(n=!1,r=s(e.helper.data("type"))):form.fields.length&&k(!1).data("target")&&(r=s(e.helper.data("type"))),r||(k(!1).remove(),x.remove(),x=null)}}).on("click keypress",function(){x=null}),t.droppable({accept:e,activate:function(t,e){G(this).addClass("ready")},over:function(){G(this).addClass("hovering")},out:function(){G(this).removeClass("hovering")},drop:function(){n=!0,G(this).removeClass("hovering")},deactivate:function(){G(this).removeClass("ready")}}),p.on("click",function(){r()}),G(document).on("gform_field_added",function(t,e,r){var i=G("#field_"+r.id);null===x?i.setGroupId(I()):(d(i,k().data("target"),k().data("where")),x.remove(),x=null),k().remove(),o(i)}),G(document).on("gform_field_deleted",function(t,e,r){i=I(G("#field_"+r))}),gform.addAction("gform_after_field_removed",function(t,e){_(i)}),gform.addAction("gform_field_duplicated",function(t,e,r,i){W(I(G("#field_"+i))).last().after(r),r.setGridColumnSpan(y).setGroupId(I()),o(r)}),gform.addAction("gform_after_refresh_field_preview",function(t){o(G("#field_"+t))})}(jQuery);