!function(l){"use strict";"undefined"!=typeof wc_instagram_product_catalog_params&&{$body:l("body"),$deleteLink:null,formFields:{},autoUpdateSlug:!0,init:function(){var t=this.getFormField("slug").val();this.autoUpdateSlug=""===t,this.toggleFormFields("slug",""!==t),l(".wc-instagram-field-editable-url").wc_instagram_editable_url(),wc_instagram_product_catalog_params.delete_link&&(this.$deleteLink=l(wc_instagram_product_catalog_params.delete_link),l("#mainform .woocommerce-save-button").after(this.$deleteLink)),this.initGoogleProductCategorySelects(),this.bindEvents()},bindEvents:function(){var i,o,n,r,c=this;this.getFormField("title").on("keyup",(i=function(){c.autoUpdateSlug&&c.refreshCatalogSlug(l(this).val())},n=!(o=1e3),function(){var t=this,e=arguments,a=n&&!r;clearTimeout(r),r=setTimeout(function(){r=null,n||i.apply(t,e)},o),a&&i.apply(t,e)})),this.getFormField("slug").on("wc_instagram_editable_url_change",function(t,e){c.refreshCatalogSlug(e)}),this.$body.on("wc_instagram_product_catalog_slug_updated",function(t,e){c.autoUpdateSlug=c.autoUpdateSlug&&""===e,c.toggleFormFields("slug",!0),c.getFormField("slug").val(e).trigger("change")}),this.$body.on("wc_instagram_subset_values_updated",function(t,e,a){var i;"product_types"===e&&(i=c.inSubset("variable",a),c.toggleFormFields(["virtual_products","downloadable_products"],c.inSubset("simple",a)),c.toggleFormFields("include_variations",i),c.toggleFormFields(["product_group_id","variation_description_field"],i&&c.getFormField("include_variations").prop("checked")))}),this.getFormField("include_variations").on("change",function(){var t=l(this).prop("checked");c.toggleFormFields("product_group_id",t),c.toggleFormFields("variation_description_field",t)}).trigger("change"),this.getFormField("product_mpn").on("change",function(){c.toggleFormFields("custom_mpn","custom"===l(this).val())}).trigger("change"),this.getFormField("include_tax").on("change",function(){c.toggleFormFields("tax_country","base"!==wc_instagram_product_catalog_params.tax_based_on&&l(this).prop("checked"))}).trigger("change"),this.$deleteLink&&this.$deleteLink.on("click",function(t){if(!window.confirm(l(this).data("confirm")))return t.preventDefault(),!1}),l(".form-table").on("change",".wc-instagram-gpc-select",function(){c.loadCategorySelect(l(this).val())})},getFormField:function(t){return this.formFields[t]||(this.formFields[t]=l("#"+t)),this.formFields[t]},toggleFormFields:function(t,a){var i=this;l.isArray(t)||(t=[t]),l.each(t,function(t,e){i.getFormField(e).closest("tr").toggle(a)})},refreshCatalogSlug:function(t){var e=this;t&&l.post({url:wc_instagram_product_catalog_params.ajax_url,data:{action:"wc_instagram_generate_product_catalog_slug",catalog_id:wc_instagram_product_catalog_params.catalog_id,catalog_title:t},dataType:"json",success:function(t){t.success&&e.$body.trigger("wc_instagram_product_catalog_slug_updated",t.data.slug)}})},inSubset:function(t,e){return""===e.option||"specific"===e.option&&-1!==e.values.indexOf(t)||"all_except"===e.option&&-1===e.values.indexOf(t)},initGoogleProductCategorySelects:function(){l(".wc-instagram-gpc-select:not(.select2-hidden-accessible)").select2({width:"auto"})},updateHiddenInput:function(t){l("#product_google_category").val(t)},loadCategorySelect:function(e){var a=this;e||l(".wc-instagram-gpc-select").each(function(){var t=l(this).val();if(""===t)return!1;e=t}),this.updateHiddenInput(e),l.post(window.wc_instagram_product_catalog_params.ajax_url,{action:"refresh_google_product_category_field",_wpnonce:window.wc_instagram_product_catalog_params.nonce,catalog_id:window.wc_instagram_product_catalog_params.catalog_id,category_id:e}).done(function(t){var e;!t.success||(e=l(".wc-instagram-gpc-select").first().closest("tr")).length&&(e.replaceWith(t.data.output),a.initGoogleProductCategorySelects())})}}.init()}(jQuery);