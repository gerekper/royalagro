"use strict";(function(){jQuery(function(c){var r,t,n,a,l,m,e,i,o,p=null!=(s=window.wc_memberships_admin)?s:{},_=null!=(s=window.wc_memberships_mailchimp_sync_admin)?s:{},s=(s=window.typenow,null!=(s=window.pagenow)?s:""),u=!1;if("woocommerce_page_wc-settings"===s&&((e=function(){var e,i,s,t,n=c("#wc_memberships_mailchimp_sync_mailchimp_api_key");if(n)return s=n.val(),e=n.closest("td").find("span.description"),i='<span class="invalid-key" style="color:'+_.status_color.failure+';">&#10005;</span>',t='<span class="valid-key"   style="color:'+_.status_color.success+';">&#10004;</span>',s?(s={action:"wc_memberships_mailchimp_sync_is_api_key_valid",api_key:s,security:_.is_valid_api_key_nonce},c.post(p.ajax_url,s,function(s){return s.success?e.html(t):e.html(i)})):e.html("")})(),i=function(){var s=c("#wc_memberships_mailchimp_sync_members_opt_in_prompt_text").closest("tr"),e=c("#wc_memberships_mailchimp_sync_members_opt_in_button_text").closest("tr");return"manual"===c('input[name="wc_memberships_mailchimp_sync_members_opt_in"]:checked').val()?(s.show(),e.show()):(s.hide(),e.hide())},c('input[name="wc_memberships_mailchimp_sync_members_opt_in"]').on("change",function(s){return i()}).change(),c("#wc_memberships_mailchimp_sync_mailchimp_api_key").on("keydown",function(s){return clearTimeout(u),u=setTimeout(e,500)}),t=c("select#wc_memberships_mailchimp_sync_default_list"),n=c("#wc-memberships-mailchimp-sync-list-settings"),a=t.val(),c(document).ready(function(){return o(t.val())}),t.on("change",function(s){var e=c(this).val();if(n&&e!==a)return o(e)}),(m=function(){return c("#wc-memberships-mailchimp-sync-sync-members").on("click",function(s){var e,i=this;return s.preventDefault(),c(this).prop("disabled",!0),c(this).next("p").addClass("sync-result").html(_.i18n.sync_in_progress),s={action:"wc_memberships_mailchimp_sync_start_members_sync",security:_.start_members_sync},e='<span class="error" style="color:'+_.status_color.failure+';">&#10005;</span> '+_.i18n.sync_error,c.post(ajaxurl,s).done(function(s){return s.success?null!=s.data.id?setTimeout(l(s.data.id),1e5):void 0:(c("p.sync-result").html(e),c(i).prop("disabled",!1))}).fail(function(){return c(i).prop("disabled",!1),c("p.sync-result").html(e)})}),c(".tips, .help_tip, .woocommerce-help-tip").tipTip({attribute:"data-tip",fadeIn:50,fadeOut:50,delay:200})})(),o=function(e){var s,i=n.find(".list-field");if(i)return i.block({message:null,overlayCSS:{"border-radius":"3px",opacity:"0.2"}}),s={action:"wc_memberships_mailchimp_sync_update_list_settings",list_id:e,security:_.update_list_settings},c.post(p.ajax_url,s,function(s){return s.success?(a=e,n.html(s.data),c(".wc-enhanced-select").select2()):(t.val(a),console.log(s)),i&&i.unblock(),m()})},l=function(s){var e,i;return 0===c("p.sync-result .progress").length&&c("p.sync-result").append(' <span class="progress"></span>'),e='<span class="error"   style="color:'+_.status_color.failure+';">&#10005;</span> '+_.i18n.sync_error,i='<span class="success" style="color:'+_.status_color.success+';">&#10004;</span> '+_.i18n.sync_success,s={action:"wc_memberships_mailchimp_sync_get_members_sync_status",security:_.get_members_sync_status,job_id:s},c.post(ajaxurl,s).done(function(s){if(s.success){if("completed"!==s.data.status)return c("p.sync-result .progress").html(s.data.finished+" / "+s.data.total),setTimeout(l(s.data.id),1e5);c("p.sync-result").html(i)}else c("p.sync-result").html(e),console.log(s.data);return c("#wc-memberships-mailchimp-sync-sync-members").prop("disabled",!1)}).fail(function(){return c("#wc-memberships-mailchimp-sync-sync-members").prop("disabled",!1),c("p.sync-result").html(e)})},_.existing_sync_id&&l(_.existing_sync_id)),"wc_user_membership"===s)return(r=c("#wc-memberships-mailchimp-user-membership-details")).find("button.sync-member").on("click",function(s){var e,i,t,n;return s.preventDefault(),n=r.find(".syncing"),i=r.find(".sync-done"),t=r.find(".sync-error"),e=n.parent(),i.hide(),t.hide(),e.hide(),e.slideToggle(),n.fadeToggle(),s={action:"wc_memberships_mailchimp_sync_update_member",user_membership_id:parseInt(c(this).data("user-membership-id"),10),security:_.sync_member},c.post(p.ajax_url,s,function(s){return n.hide(),s.success?(i.show(),e.slideToggle(),location.reload()):(t.html(s.data),t.show(),console.log(s.data))})})})}).call(void 0);