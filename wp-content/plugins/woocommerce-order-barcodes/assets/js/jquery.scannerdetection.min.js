!function(f){f.fn.scannerDetection=function(p){if("string"==typeof p)return this.each(function(){this.scannerDetectionTest(p)}),this;var e={onComplete:!1,onError:!1,onReceive:!1,timeBeforeScanTest:100,avgTimeByChar:30,minLength:6,endChar:[9,13],stopPropagation:!1,preventDefault:!1};return"function"==typeof p&&(p={onComplete:p}),p="object"!=typeof p?f.extend({},e):f.extend({},e,p),this.each(function(){function n(){o=0,a=""}var t=this,r=f(t),o=0,i=0,a="",c=!1,s=!1;t.scannerDetectionTest=function(e){return e&&(o=i=0,a=e),a.length>=p.minLength&&i-o<a.length*p.avgTimeByChar?(p.onComplete&&p.onComplete.call(t,a),r.trigger("scannerDetectionComplete",{string:a}),n(),!0):(p.onError&&p.onError.call(t,a),r.trigger("scannerDetectionError",{string:a}),n(),!1)},r.data("scannerDetection",{options:p}).unbind(".scannerDetection").bind("keydown.scannerDetection",function(e){if(o&&-1!==p.endChar.indexOf(e.which)){var n=jQuery.Event("keypress",e);n.type="keypress.scannerDetection",r.triggerHandler(n),e.preventDefault(),e.stopImmediatePropagation()}}).bind("keypress.scannerDetection",function(e){p.stopPropagation&&e.stopImmediatePropagation(),p.preventDefault&&e.preventDefault(),c=o&&-1!==p.endChar.indexOf(e.which)?(e.preventDefault(),e.stopImmediatePropagation(),!0):(a+=String.fromCharCode(e.which),!1),o=o||Date.now(),i=Date.now(),s&&clearTimeout(s),s=c?(t.scannerDetectionTest(),!1):setTimeout(t.scannerDetectionTest,p.timeBeforeScanTest),p.onReceive&&p.onReceive.call(t,e),r.trigger("scannerDetectionReceive",{evt:e})})}),this}}(jQuery);
