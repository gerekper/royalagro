!function(l){function d(t){t=function(t,r){for(key in r)r.hasOwnProperty(key)&&void 0===t[key]&&(t[key]=r[key]);return t}(t,{intent:"",total:0,formId:null,amount:null,amountType:null,products:null,productsType:null,includeShipping:!0,includeDiscounts:!1,calculateByProduct:!1});var r,n=0,a=l.isArray(t.products)&&0<t.products.length?s(t.formId,t.products,t.includeDiscounts):0;switch(t.amount||(t.amount=0),t.includeShipping||(t.total-=(r=t.formId,gformGetShippingPrice(r))),t.productsType){case"include":t.total=a;break;case"exclude":t.total-=a}switch(t.amountType){case null:n=t.total;break;case"percent":n=t.total*(t.amount/100);break;default:var o=t.amount;if(t.calculateByProduct){var i=f(t.formId);o*=100*t.total/i/100}n=o}return n=Math.max(0,parseFloat(n))}function s(t,r,n){if(void 0===r&&window._gformPriceFields?r=_gformPriceFields[t]:l.isArray(r)||(r=[r]),!r)return 0;for(var a=0,o=0;o<r.length;o++){var i=gformCalculateProductPrice(t,r[o]);if(a+=i,n)a-=Math.abs(p(t,i,r[o]))+(jQuery("#gf_coupons_"+t).val()?e(t,i):0)}return a}function f(t,r){return s(t)-(void 0!==r&&r?s(t,r):0)}function p(i,e,u){var t=l("#gform_wrapper_"+i+" .ginput_discount_input"),c=0;return t.each(function(){var t=l(this).val(),r=l(this).data("products"),n=l(this).data("productstype");if(gformIsHidden(l(this)))return 0!==t&&"0"!==t&&l(this).val(0).change(),!0;if(u&&r){if("include"==n&&(-1===l.inArray(u,r)||0===parseInt(e)))return!0;if("exclude"==n&&(-1!==l.inArray(u,r)||0===parseInt(e)))return!0}var a=u&&0<u,o=d({intent:"Calculating discount for Discount field {0}".format(l(this).attr("id")),total:e,formId:i,amount:l(this).data("amount"),amountType:l(this).data("amounttype"),products:r,productsType:n,includeShipping:!1,calculateByProduct:a});"include"===n&&0<r.length&&(o=Math.min(s(i,r,!1),o)),o*=-1,o=gform.applyFilters("gpecf_discount_total",o,l(this)),a||String(t)===String(o)||l(this).val(o).change(),c+=o}),c}function e(t,r){var n,a,o=window["gf_coupons"+t],i=0;for(n in o)o.hasOwnProperty(n)&&(a=o[n],i+=GetDiscount(a.type,a.amount,r,i));return i}function i(t){var r=rgars(window,"gf_global/gfcalc/{0}".format(t));if(r){for(var n=[],a=0;a<r.formulaFields.length;a++){var o=r.formulaFields[a];g(o.formula)&&n.push(o)}n.length&&r.runCalcs(t,n)}}function g(t){var r=-1!=t.search("{coupons}"),n=-1!=t.search("{discounts}"),a=-1!=t.search("{subtotal}");return r||n||a}function u(t,r){return Number(Math.round(t+"e"+r)+"e-"+r)}gform.addFilter("gform_calculation_formula",function(t,r,n,a){if(!g(t))return t;var o=l("#field_{0}_{1}".format(n,r.field_id)).hasClass("gfield_price");if(o&&(!window._gformPriceFields||!window._gformPriceFields.length))return t=(t=(t=t.replace(/{coupons}/gi,0)).replace(/{discounts}/gi,0)).replace(/{subtotal}/gi,0);var i=""!=(gformIsHidden(l("#gf_coupon_code_"+n))?"":l("#gf_coupon_codes_"+n).val())||""!=l("#gf_coupons_"+n).val(),e=l("#gf_total_no_discount_"+n).val(),u=0,c=-1*p(n,f(n));return void 0!==e&&i&&window.PopulateDiscountInfo&&(u=PopulateDiscountInfo(e,n)),t=(t=(t=t.replace(/{coupons}/gi,parseFloat(u))).replace(/{discounts}/gi,parseFloat(c+u))).replace(/{subtotal}/gi,parseFloat(f(n,o?[r.field_id]:null)))}),gform.addFilter("gform_coupons_discount_amount",function(t,r,n,a,o){var i=arguments.callee.caller.caller.caller.caller;if("PopulateDiscountInfo"!=i.name)return t;var e=i.arguments[1],u=gformGetShippingPrice(e);a=Math.max(0,a-u);return"percentage"==r?t=a*Number(n/100):"flat"==r&&a<(t=Number(n))&&(t=a),t}),gform.addFilter("gform_product_total",function(n,a){return l("#gform_wrapper_"+a+" .ginput_subtotal_input").each(function(){var t=l(this).val();if(gformIsHidden(l(this)))return 0!==t&&"0"!==t&&l(this).val(0).change(),!0;var r=d({intent:"Calculating subtotal for Subtotal field {0}".format(l(this).attr("id")),total:n,formId:a,amount:null,amountType:null,productsType:l(this).data("productstype"),products:l(this).data("products"),includeShipping:!1});String(t)!=String(r)&&l(this).val(r).change()}),n},48),gform.addFilter("gform_product_total",function(t,r){return t+=p(r,t),Math.max(0,t)},49),gform.addFilter("gform_product_total",function(n,a){var t=l("#gform_wrapper_"+a+" .ginput_tax_input"),o=0;return t.each(function(){var t,r=l(this).val();if(gformIsHidden(l(this)))return 0!==r&&"0"!==r&&l(this).val(0).change(),!0;t=0==n&&"exclude"===l(this).data("productstype")?0:d({intent:"Calculating tax for Tax field {0}".format(l(this).attr("id")),total:n,formId:a,amount:l(this).data("amount"),amountType:l(this).data("amounttype"),products:l(this).data("products"),productsType:l(this).data("productstype"),includeDiscounts:!0}),String(r)!==String(t)&&l(this).val(t).change(),o+=u(t,2)}),u(n+=o,2)},51),gform.addFilter("gform_product_total",function(t,r){var n=l("#gf_coupon_codes_{0}".format(r));return n.data("gpecfChanged")&&(n.data("gpecfChanged",!1),l(document).trigger("gform_post_conditional_logic")),t}),l(document).on("gform_post_render",function(t,r){l("#gf_coupon_codes_{0}".format(r)).change(function(){l(this).data("gpecfChanged",!0)}),l(document).on("gform_price_change",function(t,r,n){i(r.formId)}),gform.addAction("gpcp_after_update_pricing",function(t,r){i(r._formId)}),gform.addAction("gform_input_change",function(t,r,n){if(window!==t){var a=0===l(t).attr("id").indexOf("ginput_base_price"),o=l(t).parents(".gfield").hasClass("gfield_calculation");a&&o&&i(r)}});var n=setInterval(function(){window._gformPriceFields&&window._gformPriceFields[r]&&(i(r),clearInterval(n))});l("#gform_wrapper_"+r).find(".ginput_subtotal_input, .ginput_discount_input, .ginput_tax_input").change()})}(jQuery);
//# sourceMappingURL=gp-ecommerce-fields.js.map