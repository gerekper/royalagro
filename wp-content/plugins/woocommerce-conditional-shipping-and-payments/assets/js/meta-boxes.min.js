jQuery(function(a){a.fn.csp_scripts=function(){a(this).sw_select2(),a(this).find(".woocommerce-help-tip, .help_tip, .tips").tipTip({attribute:"data-tip",fadeIn:50,fadeOut:50,delay:200})};var n=a("#restrictions_data"),c=n.find(".bulk_toggle_wrapper"),s=n.find(".wc-metaboxes"),e=s.find(".woocommerce_restrictions__boarding"),t=n.find(".toolbar"),r=s.find(".woocommerce_restriction").length;function d(e,t){"yes"===t.val()?(t.val("no"),e.removeClass("woocommerce-input-toggle--enabled").addClass("woocommerce-input-toggle--disabled")):(t.val("yes"),e.removeClass("woocommerce-input-toggle--disabled").addClass("woocommerce-input-toggle--enabled"))}""===wc_restrictions_admin_params.post_id?(n.closest("table.form-table").removeClass("form-table").addClass("restrictions-form-table"),a(".wccsp-delete-restriction-rule").on("click",function(){return window.confirm(wc_restrictions_admin_params.i18n_delete_rule_warning)}),a(".column-wc_actions a").on("mousedown",function(){a(this).triggerHandler("mouseleave")}),n.on("click",".wc-metabox > h3",function(){a(this).parent(".wc-metabox").toggleClass("closed").toggleClass("open"),a(this).next(".wc-metabox-content").stop().slideToggle(300)}),n.sw_select2(),a(".wc-metabox",n).each(function(){var e=a(this),t=e.find(".wc-metabox-content");e.hasClass("closed")&&t.hide()})):n.sw_select2(),n.on("click",".wc-metabox > h3",function(e){e.target.id}).on("click","#active-toggle",function(){var t=a(this),o=t.closest(".wc-metabox").find(".wc-metabox-content > input.enabled"),e=t.closest(".woocommerce_restriction"),i=e.data("restriction_id"),n=e.data("index");if(-1<e[0].className.indexOf("woocommerce_restriction--added"))return d(t,o),!1;t.addClass("woocommerce-input-toggle--loading");i={action:"woocommerce_toggle_restriction",value:o.val(),post_id:wc_restrictions_admin_params.post_id,hash:s.attr("data-hash"),index:n,restriction_id:i,security:wc_restrictions_admin_params.toggle_restriction_nonce};return a.ajax({url:wc_restrictions_admin_params.wc_ajax_url,data:i,method:"POST",dataType:"json",complete:function(){t.removeClass("woocommerce-input-toggle--loading")},success:function(e){0<e.errors.length?window.alert(e.errors.join("\n\n")):(d(t,o),s.attr("data-hash",e.hash))},error:function(){window.alert(wc_restrictions_admin_params.i18n_toggle_session_expired)}}),!1}).on("click",".remove_row",function(e){var t=a(this).closest(".wc-metabox");t.find("*").off(),t.remove(),m(),e.preventDefault()}),n.on("keyup","input.short_description",function(){a(this).closest(".woocommerce_restriction").find("h3 .restriction_title_inner").text(a(this).val())}).on("click",".expand_all",function(){return s.find(".wc-metabox").each(function(){var e=a(this);e.find(".wc-metabox-content").show(),e.addClass("open").removeClass("closed")}),!1}).on("click",".close_all",function(){return s.find(".wc-metabox").each(function(){var e=a(this);e.find(".wc-metabox-content").hide(),e.addClass("closed").removeClass("open")}),!1}).on("change","select.csp_shipping_countries, select.csp_billing_countries",function(){var e,o,t=a(this),i=t.hasClass("csp_shipping_countries")?"shipping":"billing",n=(e=(e=t).selectSW("data"),o=[],a.each(e,function(e,t){o.push({key:t.id,value:t.text})}),o),e=t.closest(".condition_content, .woocommerce_restriction_form"),t="shipping"==i?e.find("select.csp_shipping_states"):e.find("select.csp_billing_states"),e=t.find(":selected"),c=[],s="shipping"==i?wc_restrictions_admin_params.shipping_states_data:wc_restrictions_admin_params.billing_states_data,r=[];e.each(function(){c.push(a(this).val())}),a.each(n,function(e,t){var o=[],i=t.key,n=t.value,t=s[i]||!1;if(!t)return!0;a.each(t,function(e,t){e=i+":"+e;o.push({id:e,text:n+" â€” "+t,selected:-1!==a.inArray(e,c)})}),r.push({text:n,children:o})}),t.children().remove(),t.selectSW({data:r})}).on("click",".wccsp_select_all",function(){var e=a(this).closest(".select-field");return e.find("select option").prop("selected","selected"),e.find("select").trigger("change"),!1}).on("click",".wccsp_select_none",function(){var e=a(this).closest(".select-field");return e.find("select option").prop("selected",!1),e.find("select").trigger("change"),!1}).on("click","button.add_restriction",function(){var e=a("select.restriction_type",n).val(),t=s.find(".woocommerce_restriction_"+e),o=s.find(".woocommerce_restriction");if(""===e)return!1;n.block({message:null,overlayCSS:{background:"#fff",opacity:.6}});var i={action:"woocommerce_add_checkout_restriction",post_id:wc_restrictions_admin_params.post_id,index:r,restriction_id:e,applied_count:t.length,count:o.length,security:wc_restrictions_admin_params.add_restriction_nonce};return r++,setTimeout(function(){a.post(wc_restrictions_admin_params.wc_ajax_url,i,function(e){var t;0<e.errors.length?window.alert(e.errors.join("\n\n")):(n.trigger("woocommerce_before_restriction_add",e),s.append(e.markup),(t=s.find(".woocommerce_restriction").last()).csp_scripts(),t.data("conditions_count",0),c.removeClass("disabled")),n.unblock(),n.trigger("woocommerce_restriction_added",e)},"json")},250),!1}).on("woocommerce_before_restriction_add",function(){e.length&&(e.hide(),t.removeClass("restriction_data--empty"))}).on("change","input.show_excluded_in_checkout",function(){var e=a(this),t=e.is(":checked"),e=e.closest(".woocommerce_restriction_data").find(".show-excluded-checked");t?e.show():e.hide()});var o,l={},i={};function _(e,t){var o=!1;return"object"==typeof i[e]&&"function"==typeof i[e][t]?o=i[e][t]:(o=wp.template("wc_csp_restriction_"+e+"_condition_"+t+"_content"),void 0===i[e]&&(i[e]={}),i[e][t]=o),o}function m(){var o=!1;s.find(".woocommerce_restriction").each(function(e,t){a(".position",t).val(e),a(".restriction_title_index",t).html(e+1),o=!0}),o?c.removeClass("disabled"):c.addClass("disabled")}s.find(".woocommerce_restriction").each(function(){var e=a(this).find(".restriction_conditions .condition_row").length;a(this).data("conditions_count",e)}),n.on("mousedown",".condition_remove .trash",function(){a(this).triggerHandler("mouseleave")}).on("click",".condition_remove .trash",function(e){return e.preventDefault(),a(this).closest(".condition_row").remove(),!0}).on("change",".condition_modifier select",function(){var e,t,o=a(this),i=a(o).data("zero_config_mods");i&&(e=o.val(),o=(t=o.closest(".condition_row_inner").find(".condition_value")).filter(".condition--disabled"),t=t.not(".condition--disabled"),-1<i.indexOf(e)?(o.show(),t.hide()):(o.hide(),t.show()))}).on("change",".condition_add select.condition_type",function(){var e=a(this),t=e.val();if("add_condition"===t)return!1;var o=e.closest(".woocommerce_restriction"),i=o.data("restriction_id"),n=parseInt(o.data("index")),c=parseInt(o.data("conditions_count")),s=function(e){var t=!1;"function"==typeof l[e]?t=l[e]:(t=wp.template("wc_csp_restriction_"+e+"_condition_row"),l[e]=t);return t}(i),i=_(i,t);if(!s||!i)return!1;n=s({condition_index:c,condition_content:i({restriction_index:n,condition_index:c})});o.data("conditions_count",c+1),o.find(".restriction_conditions_list").append(n);o=o.find(".restriction_conditions_list .condition_row").last();return o.find('.condition_type option[value="'+t+'"]').prop("selected","selected"),o.csp_scripts(),e.find('option[value="add_condition"]').prop("selected","selected"),!1}).on("change",".restriction_conditions_list select.condition_type",function(){var e=a(this),t=e.val(),o=e.closest(".woocommerce_restriction"),i=o.data("restriction_id"),n=parseInt(o.data("index")),o=e.closest(".condition_row"),e=parseInt(o.data("condition_index")),t=_(i,t);if(!t)return!1;e=t({restriction_index:n,condition_index:e});o.find(".condition_content").html(e).addClass("added");o=o.find(".added");return o.csp_scripts(),o.removeClass("added"),!1}),(o=s.find(".woocommerce_restriction").get()).sort(function(e,t){e=parseInt(a(e).attr("data-index")),t=parseInt(a(t).attr("data-index"));return e<t?-1:t<e?1:0}),a(o).each(function(e,t){s.append(t)}),m(),s.sortable({items:".woocommerce_restriction",cursor:"move",axis:"y",handle:".sort-item",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65,placeholder:"wc-metabox-sortable-placeholder",start:function(e,t){t.item.css("background-color","#f6f6f6")},stop:function(e,t){t.item.removeAttr("style"),m()}})});