/*! woocommerce-free-gift-coupons 3.0.5 */

var WC_Free_Gift_Coupons={};!function(e,t){t.Product=Backbone.Model.extend({defaults:{quantity:1,title:"",product_id:"",variation_id:"",gift_id:""},initialize:function(){this.get("gift_id").length||this.set("gift_id",this.get("variation_id")>0?this.get("variation_id"):this.get("product_id"))}}),t.ProductsCollection=Backbone.Collection.extend({model:t.Product,el:"#wc-free-gift-container"}),t.productView=Backbone.View.extend({model:t.Product,tagName:"tr",events:{"click .delete-product":"removeProduct","change .product-quantity :input":"setQuantity"},template:wp.template("wc-free-gift-product"),render:function(){return this.$el.html(this.template(this.model.toJSON())),this},reorder:function(e,t){this.$el.trigger("update-sort",[this.model,t])},removeProduct:function(e){e.preventDefault(),this.model.destroy(),t.productList.render()},setQuantity:function(e){value=this.$el.find(".product-quantity :input").val(),this.model.set("quantity",value)}}),t.productListTable=Backbone.View.extend({el:"#wc-free-gift-table",template:wp.template("wc-free-gift-products-table-header"),addSingle:function(e){var i=new t.productView({model:e});this.$el.find("tbody").prepend(i.render().el)},addProduct:function(e,i){Product=new t.Product(i),this.collection.add(Product,{at:0}),this.render()},events:{"click .delete-product":"removeProduct",addFreeGiftProduct:"addProduct"},render:function(){return this.$el.children().remove(),this.collection.length&&(this.$el.html(this.template()),this.collection.each(function(e){this.$el.find("tbody").append(new t.productView({model:e}).render().el)},this)),this}}),t.initApplication=function(){t.productCollection=new t.ProductsCollection(woocommerce_free_gift_coupon_meta_i18n.free_gifts),t.productList=new t.productListTable({collection:t.productCollection}),t.productList.render()},jQuery(function(e){t.initApplication(),e("#wc-free-gift-table").sortable({items:"tbody > tr",handle:".product-title",axis:"y",opacity:.5,grid:[20,10],tolerance:"pointer"}),e(document.body).trigger("wc-enhanced-select-init"),e("#free_gift_ids").hasClass("select2-hidden-accessible")&&e("#free_gift_ids").on("select2:select",function(t){var i=t.params.data;if(i.id.length){var o={gift_id:i.id,title:i.text};e("#wc-free-gift-table").trigger("addFreeGiftProduct",o),e(this).val([]).change(),e("#wc-free-gift-table").sortable("refresh")}}),e("select#discount_type").change(function(){var t=e(this).val();$toggle_fields=e(".coupon_amount_field"),coupon_types=jQuery.parseJSON(woocommerce_free_gift_coupon_meta_i18n.coupon_types),-1!==e.inArray(t,coupon_types)?(e(".show_if_free_gift").show(),"free_gift"==t?$toggle_fields.hide():$toggle_fields.show()):(e(".show_if_free_gift").hide(),$toggle_fields.show())}).change()})}(jQuery,WC_Free_Gift_Coupons);