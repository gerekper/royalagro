!function(l){l(function(){function n(t){(t=t||l(".wc-photography-collections-select")).trigger("change.select2"),t=l(t).filter(":not(.enhanced)");var e={placeholder:WCPhotographyCustomerParams.search_placeholder,minimumInputLength:2,multiple:!0,ajax:{url:WCPhotographyCustomerParams.ajax_url,dataType:"json",quietMillis:200,data:function(t){return{term:WCPhotographyCustomerParams.isLessThanWC30?t:t.term,action:"wc_photography_search_collections",security:WCPhotographyCustomerParams.search_collections_nonce}},processResults:function(t){return{results:t}}}};WCPhotographyCustomerParams.isLessThanWC30&&(e.initSelection=function(t,e){return e(l.parseJSON(t.attr("data-selected")))},e.formatSelection=function(t){return'<div class="selected-option" data-id="'+t.id+'">'+t.text+"</div>"},e.ajax.results=e.ajax.processResults),t.select2(e).addClass("enhanced")}n(),l("body").on("click",".photography-add-collection a",function(){return l(this).next(".fields").toggle(),!1}).on("click",".photography-add-collection .button",function(){var r=l(this),c=r.closest(".collection-form-field"),i=l("input.new-collection",c),t=i.val();return""===t?i.focus():(i.attr("disabled","disabled"),r.attr("disabled","disabled").next(".message").remove(),r.after(' <i class="loading">'+WCPhotographyCustomerParams.loading+"</i>"),l.ajax({url:WCPhotographyCustomerParams.ajax_url,data:{action:"wc_photography_add_collection",security:WCPhotographyCustomerParams.add_collection_nonce,name:t},type:"POST",dataType:"json",success:function(t){if(i.val(""),i.removeAttr("disabled"),r.removeAttr("disabled").next(".loading").remove(),t.success)if(WCPhotographyCustomerParams.isLessThanWC30){var e=l("input.wc-photography-collections-select",c),o=[],s=[];l(".selected-option",c).each(function(t,e){var a=l(e);o.push({id:a.attr("data-id"),text:a.text()}),s.push(a.attr("data-id"))}),o.push(t.data),s.push(t.data.id),e.attr("data-selected",JSON.stringify(o)).val(s.toString()),n(e),l(".fields",c).toggle()}else{e=l(".wc-photography-collections-select");var a=new Option(t.data.text,t.data.id);a.selected=!0,e.append(a)}else r.after('<div class="error inline message">'+WCPhotographyCustomerParams.collection_error+"</div>")}})),!1}).on("select2-selecting",".wc-photography-collections-select",function(t){var e=l(this).prev(".wc-photography-collections-select"),o=[];l(".selected-option",e).each(function(t,e){var a=l(e);o.push({id:a.attr("data-id"),text:a.text()})}),o.push({id:t.choice.id,text:t.choice.text}),l(this).attr("data-selected",JSON.stringify(o))}).on("select2-removed",".wc-photography-collections-select",function(){var t=l(this).prev(".wc-photography-collections-select"),o=[];l(".selected-option",t).each(function(t,e){var a=l(e);o.push({id:a.attr("data-id"),text:a.text()})}),l(this).attr("data-selected",JSON.stringify(o))})})}(jQuery);
